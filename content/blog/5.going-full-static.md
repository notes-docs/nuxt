---
title: 'Going Full Static'
description: 'JAMstack ç²‰ä¸ä»¬æœŸå¾…å·²ä¹…çš„ç‰¹æ€§å·²åœ¨ v2.13 ä¸­å‘å¸ƒï¼šå®Œæ•´çš„é™æ€å¯¼å‡ºã€æ”¹è¿›çš„æ™ºèƒ½é¢„å–ã€é›†æˆçš„çˆ¬è™«ã€æ›´å¿«çš„é‡æ–°éƒ¨ç½²ã€å†…ç½®çš„ Web æœåŠ¡å™¨ä»¥åŠæ–°çš„é…ç½® target é€‰é¡¹ âš¡ï¸'
image: /assets/blog/going-full-static.png
date: 2020-06-18
authors:
  - name: Sebastien Chopin
    avatar:
      src: https://github.com/Atinux.png
    to: https://x.com/atinux
    twitter: atinux
category: Release
---

## æ‡’äººé€šé“

1. å°† nuxt å‡çº§åˆ° `2.14.0`
2. åœ¨ä½ çš„ `nuxt.config.js` ä¸­è®¾ç½® `target: 'static'`
3. è¿è¡Œ `nuxt generate`
4. å°±è¿™æ · âœ¨

_å¥–åŠ±ï¼šä½ å¯ä»¥è¿è¡Œ `nuxt start` æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œç”¨äºæä¾›ä½ ç”Ÿæˆçš„é™æ€åº”ç”¨ç¨‹åºã€‚_

::video{poster="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.jpg" controls autoplay}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.webm" type="video/webm"}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.mp4" type="video/mp4"}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.ogg" type="video/ogg"}
::

æ³¨æ„ï¼šåœ¨æ­¤è§†é¢‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `nuxt export`ï¼Œè¯¥å‘½ä»¤å·²è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ `nuxt generate`ã€‚

## å†å²

è‡ª [v0.3.2](https://github.com/nuxt/nuxt.js/releases/tag/v0.3.2)ï¼ˆ2016 å¹´ 11 æœˆï¼‰ä»¥æ¥ï¼ŒNuxt å°±é€šè¿‡ `nuxt generate` å…·å¤‡äº†é™æ€ç”ŸæˆåŠŸèƒ½ï¼Œæ­¤åæˆ‘ä»¬ä»¥å¤šç§æ–¹å¼å¯¹å…¶è¿›è¡Œäº†æ”¹è¿›ï¼Œä½†ä»æœªå®ç°å®Œå…¨çš„é™æ€ç”Ÿæˆã€‚ä»Šå¤©ï¼Œæˆ‘å¾ˆé«˜å…´åœ°å®£å¸ƒï¼ŒNuxt 2.13 ç°åœ¨å¯ä»¥å®ç°å®Œå…¨é™æ€å¯¼å‡ºã€‚

## å½“å‰é—®é¢˜

`nuxt generate` ä¸»è¦è¿›è¡Œé¢„æ¸²æŸ“ï¼Œå½“æ‚¨åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶ï¼Œä¼šè°ƒç”¨ `asyncData` å’Œ `fetch`ï¼Œ_å‘æ‚¨çš„ API å‘å‡ºè¯·æ±‚_ã€‚è®¸å¤šç”¨æˆ·è¦æ±‚æ”¯æŒ â€œå®Œå…¨é™æ€â€ æ¨¡å¼ï¼Œè¿™æ„å‘³ç€åœ¨å¯¼èˆªæ—¶ä¸å†è°ƒç”¨è¿™ä¸¤ä¸ªé’©å­ï¼Œå› ä¸ºä¸‹ä¸€é¡µå·²ç»é¢„æ¸²æŸ“å®Œæ¯•ã€‚

æ­¤å¤–ï¼Œå¼€å‘è€…ä½“éªŒä¹Ÿä¸æ˜¯æœ€ä½³çš„ï¼š

- æ‚¨å¯ä»¥åœ¨ SSR ä¸Šè®¿é—® `req` æˆ– `res`ï¼Œä½†åœ¨è¿è¡Œ `nuxt generate` æ—¶åˆ™ä¸èƒ½
- `process.static` ä»…åœ¨è¿è¡Œ `nuxt generate` æ—¶ä¸º `true`ï¼Œè¿™ä½¿å¾—ä¸ºé™æ€ç”Ÿæˆå¼€å‘ Nuxt æ¨¡å—æˆ–æ’ä»¶å¾ˆæ…¢
- æ‚¨å¿…é¡»åœ¨ `generate.routes` ä¸­æŒ‡å®šæ‰€æœ‰ [åŠ¨æ€è·¯ç”±](https://v2.nuxt.com/docs/features/file-system-routing#dynamic-routes)ï¼Œç”±äºæ‚¨æ— æ³•åœ¨é‚£é‡Œè®¿é—® nuxt æ¨¡å—ï¼Œè¿™ä½¿å¾—æ“ä½œæ›´åŠ å›°éš¾ã€‚
- æ‚¨æ— æ³•åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯• [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ï¼Œå›é€€æ˜¯æ‚¨çš„ Nuxt åº”ç”¨ç¨‹åºçš„ä»…å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œåœ¨å‘½ä¸­ 404 é¡µé¢æ—¶åŠ è½½
- `nuxt generate` é»˜è®¤è¿è¡Œ `nuxt build`ï¼Œå¦‚æœåªæœ‰æ‚¨çš„å†…å®¹å‘ç”Ÿæ›´æ”¹ï¼Œè¿™ä¼šä½¿ç”Ÿæˆæ‚¨çš„ç½‘ç«™å˜æ…¢

è¯·æ³¨æ„ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨ [nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor) æ¨¡å—å®ç°å®Œå…¨é™æ€æ”¯æŒï¼Œä½†ä½¿ç”¨èµ·æ¥æ›´åŠ ç¹çå¹¶ä¸”å­˜åœ¨å±€é™æ€§ã€‚

## æ–°çš„é…ç½®é€‰é¡¹ï¼š`target`

ä¸ºäº†æ”¹å–„ç”¨æˆ·ä½“éªŒå¹¶å‘ŠçŸ¥ Nuxt æ‚¨å¸Œæœ›å°†åº”ç”¨ç¨‹åºå¯¼å‡ºåˆ°é™æ€æ‰˜ç®¡ï¼Œæˆ‘ä»¬åœ¨æ‚¨çš„ `nuxt.config.js` ä¸­å¼•å…¥äº†ä¸€ä¸ª `target` é€‰é¡¹ï¼š

```vue
<script setup>
  import { ref, computed } from '#imports'

  const count = ref(1)
  const double = computed(() => count.value * 2)
</script>
```

::important
å®Œå…¨é™æ€ä¸æ”¯æŒ `ssr: 'false'`ï¼ˆä¸å·²å¼ƒç”¨çš„ `mode: 'spa'` ç›¸åŒï¼‰ï¼Œå› ä¸ºå®ƒä»…ç”¨äºå®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆå•é¡µåº”ç”¨ç¨‹åºï¼‰ã€‚
::

ä½¿ç”¨é™æ€ç›®æ ‡è¿è¡Œ `nuxt dev` å°†æ”¹å–„å¼€å‘è€…ä½“éªŒï¼š

- ä»ä¸Šä¸‹æ–‡ä¸­ç§»é™¤ `req` å’Œ `res`
- åœ¨ 404ã€é”™è¯¯å’Œé‡å®šå‘æ—¶å›é€€åˆ°å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆè¯·å‚é˜… [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ï¼‰
- `$route.query` åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶å§‹ç»ˆç­‰äº `{}`
- `process.static` ä¸º `true`

æˆ‘ä»¬è¿˜å…¬å¼€äº† `process.target`ï¼Œä¾›æ¨¡å—ä½œè€…æ ¹æ®ç”¨æˆ·ç›®æ ‡æ·»åŠ é€»è¾‘ã€‚

## æ›´æ™ºèƒ½çš„ `nuxt generate`

ç°åœ¨ï¼Œä½¿ç”¨ `v2.14.0`ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ `nuxt generate`ï¼Œå®ƒä¼šæ™ºèƒ½åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦æ„å»ºã€‚

### æé€Ÿçš„é™æ€åº”ç”¨

å¸¦æœ‰ `target: 'static'` çš„ `nuxt generate` ä¼šå°†æ‚¨çš„æ‰€æœ‰é¡µé¢é¢„æ¸²æŸ“ä¸º HTMLï¼Œå¹¶ä¿å­˜ä¸€ä¸ª payload æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶æ¨¡æ‹Ÿ `asyncData` å’Œ `fetch`ï¼Œè¿™æ„å‘³ç€åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶ä¸å†éœ€è¦å‘æ‚¨çš„ API å‘é€ HTTP è¯·æ±‚ã€‚é€šè¿‡å°†é¡µé¢ payload æå–åˆ° js æ–‡ä»¶ä¸­ï¼Œå®ƒè¿˜å‡å°äº†æ‰€æä¾›çš„ HTML å¤§å°ï¼Œå¹¶é¢„åŠ è½½å®ƒï¼ˆé€šè¿‡ header ä¸­çš„ <link>ï¼‰ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚

åœ¨è¿›è¡Œå®Œå…¨é™æ€ç”Ÿæˆæ—¶ï¼Œæˆ‘ä»¬è¿˜æ”¹è¿›äº† [æ™ºèƒ½é¢„å–](/blog/introducing-smart-prefetching)ï¼Œå®ƒä¹Ÿä¼šè·å– payloadï¼Œä»è€Œå®ç°å³æ—¶å¯¼èˆª ğŸ‘€

### é›†æˆçˆ¬è™«

é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å†…ç½®äº†ä¸€ä¸ªçˆ¬è™«ï¼Œå¯ä»¥æ£€æµ‹æ¯ä¸ªç›¸å¯¹é“¾æ¥å¹¶ç”Ÿæˆå®ƒï¼š

å¦‚æœæ‚¨æƒ³æ’é™¤ä¸€æ‰¹è·¯ç”±ï¼Œè¯·ä½¿ç”¨ [generate.exclude](https://v2.nuxt.com/docs/configuration-glossary/configuration-generate#exclude)ã€‚æ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨ [generate.routes](https://v2.nuxt.com/docs/configuration-glossary/configuration-generate#routes) æ¥æ·»åŠ çˆ¬è™«æ— æ³•æ£€æµ‹åˆ°çš„é¢å¤–è·¯ç”±ã€‚

è¦ç¦ç”¨çˆ¬è™«ï¼Œè¯·åœ¨æ‚¨çš„ `nuxt.config.js` ä¸­è®¾ç½® `generate.crawler: false`

### æ›´å¿«çš„é‡æ–°éƒ¨ç½²

é€šè¿‡åˆ†ç¦» `nuxt build` å’Œ `nuxt export`ï¼Œæˆ‘ä»¬å¼€å¯äº†ä¸€ç³»åˆ—æ–°çš„æ”¹è¿›ï¼šä»…åœ¨æ‚¨çš„å†…å®¹å‘ç”Ÿæ›´æ”¹æ—¶æ‰é¢„æ¸²æŸ“æ‚¨çš„é¡µé¢ï¼Œè¿™æ„å‘³ç€ï¼šæ— éœ€ webpack æ„å»º â†’ æ›´å¿«çš„é‡æ–°éƒ¨ç½²ã€‚

## æ›´æ™ºèƒ½çš„ `nuxt start`

ä¸€æ—¦æ‚¨å°† Nuxt åº”ç”¨ç¨‹åºé™æ€ç”Ÿæˆåˆ° `dist/` ä¸­ï¼Œè¯·ä½¿ç”¨ `nuxt start` å¯åŠ¨ä¸€ä¸ªç”Ÿäº§ HTTP æœåŠ¡å™¨å¹¶æä¾›æ‚¨çš„é™æ€åº”ç”¨ç¨‹åºï¼Œæ”¯æŒ [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ã€‚

æ­¤å‘½ä»¤éå¸¸é€‚åˆåœ¨æ¨é€åˆ°æ‚¨å–œæ¬¢çš„é™æ€æ‰˜ç®¡æä¾›å•†ä¹‹å‰åœ¨æœ¬åœ°æµ‹è¯•æ‚¨çš„é™æ€åº”ç”¨ç¨‹åºã€‚

## é¢„è§ˆæ¨¡å¼

æˆ‘ä»¬å¼€ç®±å³ç”¨åœ°æ”¯æŒå®æ—¶é¢„è§ˆä»¥ç»§ç»­è°ƒç”¨æ‚¨çš„ APIï¼š

```js{}[plugins/preview.client.js]
export default async function ({ query, enablePreview }) {
  if (query.preview) {
    enablePreview()
  }
}
```

å®ƒå°†è‡ªåŠ¨åˆ·æ–°é¡µé¢æ•°æ®ï¼ˆè°ƒç”¨ `nuxtServerInit`ã€`asyncData` å’Œ `fetch`ï¼‰ã€‚

å½“é¢„è§ˆæ¨¡å¼æ¿€æ´»æ—¶ï¼Œå°†è°ƒç”¨ `asyncData` å’Œ `fetch` çš„åŸå§‹æ–¹æ³•ã€‚

## å‘½ä»¤

æ ¹æ® `target` çš„ä¸åŒï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

- `server`
  - `nuxt dev`: å¯åŠ¨å¼€å‘æœåŠ¡å™¨
  - `nuxt build`: ä¸ºç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ‚¨çš„ Nuxt åº”ç”¨ç¨‹åº
  - `nuxt start`: å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `static`
  - `nuxt dev`: å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆé™æ€æ„ŸçŸ¥ï¼‰
  - `nuxt generate`: å¦‚æœéœ€è¦ï¼ˆé™æ€æ„ŸçŸ¥ï¼‰ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ‚¨çš„ Nuxt åº”ç”¨ç¨‹åºï¼Œå¹¶å°†æ‚¨çš„åº”ç”¨ç¨‹åºå¯¼å‡ºåˆ° `dist/` ç›®å½•ä¸­çš„é™æ€ HTML
  - `nuxt start`: ä» `dist/` æä¾›æ‚¨çš„ç”Ÿäº§åº”ç”¨ç¨‹åº

### æ¥ä¸‹æ¥åšä»€ä¹ˆ

::read-more{to="https://v2.nuxt.com/tutorials/moving-from-nuxtjs-dotenv-to-runtime-config" target="_blank"}
äº†è§£æ›´å¤šå…³äºå¦‚ä½•ä» `@nuxtjs/dotenv` è¿ç§»åˆ°è¿è¡Œæ—¶é…ç½®çš„ä¿¡æ¯ã€‚
::
